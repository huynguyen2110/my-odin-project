(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class m{constructor(e){this.coordinates=e,this.hits=[],this.isSunk=!1}addHit(e){this.hits.find(s=>s.x===e.x&&s.y===e.y)||(this.hits.push(e),this.setSunk())}setSunk(){this.hits.length===this.coordinates.length&&(this.isSunk=!0)}}class f{constructor(e=10){this.board=this._init(e),this.ships=[],this.recentHit=[]}_init(e){const t=[];for(let s=0;s<e;s++)t.push(Array.from({length:e},()=>null));return t}getAllBoardCoordinates(e=this.board){const t={};for(let s=0;s<e.length;s++)for(let r=0;r<e.length;r++)t[`${s}_${r}`]={x:s,y:r};return t}getAllShipCoordinates(e=this.ships){const t={};for(let s=0;s<e.length;s++)for(let r=0;r<e[s].coordinates.length;r++){const i=e[s].coordinates[r].x,a=e[s].coordinates[r].y;t[`${i}_${a}`]={x:i,y:a}}return t}getShipCoordinateExpect(e,t,s,r){const i=[];if(r)for(let a=0;a<s;a++)i.push({x:e+a,y:t});else for(let a=0;a<s;a++)i.push({x:e,y:t+a});return i}isValidPlace(e){return!(e[0].x<0||e[0].x>this.board.length-1||e[0].y<0||e[0].y>this.board.length-1||e[e.length-1].x>this.board.length-1||e[e.length-1].y>this.board.length-1)}isPlaceShipAble(e,t=this.ships){if(!this.isValidPlace(e))return!1;const s=this.getAllShipCoordinates(t);for(let r=0;r<e.length;r++)if(s[`${e[r].x-1}_${e[r].y-1}`]||s[`${e[r].x-1}_${e[r].y}`]||s[`${e[r].x-1}_${e[r].y+1}`]||s[`${e[r].x}_${e[r].y-1}`]||s[`${e[r].x}_${e[r].y}`]||s[`${e[r].x}_${e[r].y+1}`]||s[`${e[r].x+1}_${e[r].y-1}`]||s[`${e[r].x+1}_${e[r].y}`]||s[`${e[r].x+1}_${e[r].y+1}`])return!1;return!0}placeShip(e,t=this.ships){t.push(new m(e))}isReceiveAttackAble(e,t){return e<0||e>this.board.length-1||t<0||t>this.board.length-1?!1:this.board[e][t]!==0}receiveAttack(e,t){if(this.board[e][t]===0)return{status:"AlREADY_HIT",data:{x:e,y:t}};this.board[e][t]=0;const s=this.ships.find(i=>i.coordinates.some(a=>a.x===e&&a.y===t));if(!s)return{status:"NOT_HIT",data:{x:e,y:t}};if(s.addHit({x:e,y:t}),!s.isSunk)return this.recentHit.push({x:e,y:t}),{status:"HIT",data:{x:e,y:t}};let r=!0;for(let i=0;i<this.ships.length;i++)if(!this.ships[i].isSunk){r=!1;break}return r?{status:"END_GAME",data:{hits:s,lastCoordinate:{x:e,y:t}}}:(this.recentHit=[],{status:"SUNK",data:{hits:s,lastCoordinate:{x:e,y:t}}})}getCoordinatesEmptyBoard(){const e=Object.keys(this.getAllShipCoordinates()),t=this.getAllBoardCoordinates();for(let s=0;s<e.length;s++)delete t[s];return t}getCoordinatesNotFired(e=this.board){const t={};for(let s=0;s<e.length;s++)for(let r=0;r<e.length;r++)e[s][r]===null&&(t[`${s}_${r}`]={x:s,y:r});return t}getRandomInArray(e){return e[Math.floor(Math.random()*e.length)]}randomPlaceShips(e){this.ships=[];const t=JSON.parse(JSON.stringify(e));let s=Object.values(this.getAllBoardCoordinates());for(;t.length>0;){const r=this.getRandomInArray(s),i=t[0],a=this.getShipCoordinateExpect(r.x,r.y,parseInt(Object.keys(i)[0]),Math.random()<.5);this.isPlaceShipAble(a)&&(this.placeShip(a),i[Object.keys(i)[0]]-=1,Object.values(t[0])[0]===0&&t.shift())}return this.getAllShipCoordinates()}resetPlaceShips(){this.ships=[]}randomFire(){let e=Object.values(this.getCoordinatesNotFired());return this.getRandomInArray(e)}intelligenceFired(){if(this.recentHit.length===0)return this.randomFire();{let e=[];if(this.recentHit.length===1)e=[{x:this.recentHit[0].x-1,y:this.recentHit[0].y},{x:this.recentHit[0].x,y:this.recentHit[0].y-1},{x:this.recentHit[0].x,y:this.recentHit[0].y+1},{x:this.recentHit[0].x+1,y:this.recentHit[0].y}];else if(this.recentHit[0].x===this.recentHit[1].x){const t=this.recentHit.sort((s,r)=>s.y-r.y);e=[{x:t[0].x,y:t[0].y-1},{x:t[0].x,y:t[t.length-1].y+1}]}else{const t=this.recentHit.sort((s,r)=>s.x-r.x);e=[{x:t[0].x-1,y:t[0].y},{x:t[t.length-1].x+1,y:t[0].y}]}for(let t=0;t<e.length;t++)if(this.isReceiveAttackAble(e[t].x,e[t].y))return{x:e[t].x,y:e[t].y}}return this.randomFire()}checkShipVertical(e){return e.length===1?!0:e[0].x!==e[1].x}changeOldShipCoordinateDragDrop(e,t,s,r,i=!1){let a=structuredClone(this.ships);const n=a.find(l=>l.coordinates[0].x===e&&l.coordinates[0].y===t);if(!n)return console.log("err shipRelocate"),!1;a=a.filter(l=>!(l.coordinates[0].x===e&&l.coordinates[0].y===t));let c=this.checkShipVertical(n.coordinates);i&&(c=!c);const d=this.getShipCoordinateExpect(s,r,n.coordinates.length,c);return this.isPlaceShipAble(d,a)?(this.ships=this.ships.filter(l=>!(l.coordinates[0].x===e&&l.coordinates[0].y===t)),this.placeShip(d,this.ships),d):(console.log("err isPlaceShipAble"),!1)}}class g{constructor(e){this.name=e,this.gameboard=new f}fire(){}}class S{initialGrid(e,t){document.querySelector(".wrap-p1-grid");const s=document.querySelector(".p1-grid");s.innerHTML="";for(let i=0;i<100;i++){const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-axis",`${parseInt(i/10)}_${i%10}`),s.appendChild(a),t!=="computer"&&a.addEventListener("click",n=>{const c=parseInt(n.target.getAttribute("data-axis")[0]),d=parseInt(n.target.getAttribute("data-axis")[2]);e(c,d)})}document.querySelector(".wrap-p2-grid");const r=document.querySelector(".p2-grid");r.innerHTML="";for(let i=0;i<100;i++){const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-axis",`${parseInt(i/10)}_${i%10}`),r.appendChild(a),a.addEventListener("click",n=>{const c=parseInt(n.target.getAttribute("data-axis")[0]),d=parseInt(n.target.getAttribute("data-axis")[2]);e(c,d)})}}generateDragDropShops(e,t,s){const i=this.getGridPlayerContainer(t).querySelector(".drag-drop");i.classList.remove("hide-div"),i.innerHTML="",e.forEach(a=>{const n=Object.keys(a)[0],c=a[n],d=document.createElement("div");d.classList.add(`ship-length-${n}`),d.classList.add("flex-ship");for(let u=0;u<c;u++){const l=document.createElement("div");l.id=`drag-${n}-${u+1}`,l.setAttribute("data-length",n),l.setAttribute("draggable","true"),l.setAttribute("ondragstart","play.drag(event)"),l.classList.add("flex-ship-coordinates"),l.classList.add("position-relative"),l.addEventListener("click",y=>{s(y)});for(let y=0;y<n;y++){const p=document.createElement("div");p.classList.add("cell"),p.classList.add("drag"),p.classList.add("place-ship"),l.appendChild(p)}d.appendChild(l)}i.appendChild(d)})}getGridPlayer(e){return e==="player 1"?document.querySelector(".p1-grid"):document.querySelector(".p2-grid")}getGridPlayerContainer(e){return e==="player 1"?document.querySelector(".your-grid-container"):document.querySelector(".opponent-grid-container")}renderRandomShips(e,t){this.resetRenderShips(t),this.getGridPlayerContainer(t).querySelector(".drag-drop").classList.add("hide-div");const i=this.getGridPlayer(t),a=Object.keys(e);for(let n=0;n<a.length;n++)i.querySelector(`[data-axis='${a[n]}']`).classList.add("place-ship")}resetRenderShips(e){const s=this.getGridPlayer(e).querySelectorAll(".cell");for(let r=0;r<s.length;r++)s[r].classList.remove("place-ship"),s[r].firstElementChild&&s[r].removeChild(s[r].firstElementChild)}renderCoordinate(e,t,s){const i=this.getGridPlayer(t).querySelector(`[data-axis='${e.x}_${e.y}']`);if(s){i.classList.add("hit");const a=i.querySelector(".cell");a&&a.classList.add("hit")}else i.classList.add("not-hit")}renderSunk(e,t){const s=this.getGridPlayer(t);for(let r=0;r<e.hits.coordinates.length;r++){const i=s.querySelector(`[data-axis='${e.hits.coordinates[r].x}_${e.hits.coordinates[r].y}']`),a=i.querySelector(".cell");e.hits.coordinates[r].x===e.lastCoordinate.x&&e.hits.coordinates[r].y===e.lastCoordinate.y&&(i.classList.add("hit"),a&&a.classList.add("hit")),i.classList.add("sunk"),a&&a.classList.add("sunk")}}renderEndGame(e,t,s,r){this.renderSunk(e,t,!0),this.showVictory(s,r)}showVictory(e,t){const s=document.querySelector(".show-result"),r=document.querySelector(".show-image-win"),i=document.querySelector(".text-show-result");setTimeout(()=>{s.classList.remove("hide-div")},500),t==="computer"?r.src="src/images/icon-bot.svg":r.src="src/images/icon-human.svg",i.textContent=e.toUpperCase()+" TAKES THE ROUND"}disableGridCurrentPlayer(e){let t=null,s=null,r=null,i=null;e==="player 1"?(t=document.querySelector(".wrap-p1-grid"),s=document.querySelector(".p1-grid"),r=document.querySelector(".wrap-p2-grid"),i=document.querySelector(".p2-grid")):(t=document.querySelector(".wrap-p2-grid"),s=document.querySelector(".p2-grid"),r=document.querySelector(".wrap-p1-grid"),i=document.querySelector(".p1-grid")),t.classList.add("cursor-disabled"),s.classList.add("disable"),r.classList.remove("cursor-disabled"),i.classList.remove("disable")}disableAllPlayer(){const e=document.querySelector(".wrap-p1-grid"),t=document.querySelector(".p1-grid"),s=document.querySelector(".wrap-p2-grid"),r=document.querySelector(".p2-grid");e.classList.add("cursor-disabled"),t.classList.add("disable"),s.classList.add("cursor-disabled"),r.classList.add("disable")}enableAllPlayer(){const e=document.querySelector(".wrap-p1-grid"),t=document.querySelector(".p1-grid"),s=document.querySelector(".wrap-p2-grid"),r=document.querySelector(".p2-grid");e.classList.remove("cursor-disabled"),t.classList.remove("disable"),s.classList.remove("cursor-disabled"),r.classList.remove("disable")}disableActionButtons(){const e=document.querySelector(".start"),t=document.querySelectorAll(".button-template");for(let s of t)s.disabled=!0;e.classList.add("disableStart"),e.disabled=!0}enableActionButtons(){const e=document.querySelector(".start"),t=document.querySelectorAll(".button-template"),s=document.querySelectorAll(".drag-drop");for(let r of s)r.classList.add("hide-div");for(let r of t)r.disabled=!1;e.classList.remove("disableStart"),e.disabled=!1}hideShowDivResult(){document.querySelector(".show-result").classList.add("hide-div")}renderShipDirections(e){const t=document.querySelector(`[data-coordinate='${e[0].x}_${e[0].y}']`);t.classList.contains("flex-ship-coordinates")?t.classList.remove("flex-ship-coordinates"):t.classList.add("flex-ship-coordinates")}hideScreenChooseMode(){const e=document.querySelector(".choose-mode"),t=document.querySelector(".playground");e.classList.add("hide-div"),t.classList.remove("hide-div")}}const o=new S;class b{constructor(){this.factoryShips=[{4:1},{3:2},{2:3},{1:4}],this.mode=null,this.players=[],this.currentPlayer=null,this.isStart=!1,this.timer=null}handleButtonStartGame(e){if(this.mode=document.querySelector('input[name="mode"]:checked').value,this.mode==="human"){alert("unfinished");return}this.initialGame(),o.hideScreenChooseMode()}initialGame(e=!1){this.players=[];const t=new g("player 1");this.players=[...this.players,t];let s=null;this.mode==="computer"?s=new g("computer"):s=new g("player 2"),s.gameboard.randomPlaceShips(this.factoryShips),this.players=[...this.players,s],o.initialGrid((r,i)=>this.getAttack(r,i),this.mode),this.currentPlayer=t}randomShips(e){const t=this.currentPlayer.gameboard.randomPlaceShips(this.factoryShips);this.currentPlayer!=="computer"&&o.renderRandomShips(t,this.currentPlayer.name)}processComputerFire(){const e=this.getEnemyPlayer().gameboard.intelligenceFired();this.getAttack(e.x,e.y)}getAttack(e,t){if(!this.isStart){alert("Place enough your ships and enter the button start game");return}const s=this.getEnemyPlayer(),r=s.gameboard.receiveAttack(e,t);switch(r.status){case"AlREADY_HIT":{this.timer=setTimeout(()=>{o.disableGridCurrentPlayer(this.currentPlayer.name)},0);break}case"NOT_HIT":this.timer=setTimeout(()=>{o.renderCoordinate(r.data,s.name,!1),this.currentPlayer=this.getEnemyPlayer(),o.disableGridCurrentPlayer(this.currentPlayer.name),this.currentPlayer.name==="computer"&&this.processComputerFire()},500);break;case"HIT":this.timer=setTimeout(()=>{o.renderCoordinate(r.data,s.name,!0),o.disableGridCurrentPlayer(this.currentPlayer.name),this.currentPlayer.name==="computer"&&this.processComputerFire()},500);break;case"SUNK":this.timer=setTimeout(()=>{o.renderSunk(r.data,s.name),o.disableGridCurrentPlayer(this.currentPlayer.name),this.currentPlayer.name==="computer"&&this.processComputerFire()},500);break;case"END_GAME":o.renderEndGame(r.data,s.name,this.currentPlayer.name,this.mode)}o.disableAllPlayer()}getEnemyPlayer(){return this.players.find(e=>e.name!==this.currentPlayer.name)}generateDragDrop(){this.currentPlayer.gameboard.resetPlaceShips(),o.resetRenderShips(this.currentPlayer.name),o.generateDragDropShops(this.factoryShips,"player 1",e=>this.reverseShipDirection(e))}allowDrop(e){e.preventDefault()}drag(e){e.dataTransfer.setData("id",e.target.id),e.dataTransfer.setData("length",e.target.getAttribute("data-length")),e.target.getAttribute("data-coordinate")&&e.dataTransfer.setData("coordinate",e.target.getAttribute("data-coordinate"))}drop(e){const t=e.dataTransfer.getData("id"),s=e.dataTransfer.getData("length");if(!e.target.getAttribute("data-axis"))return;const r=parseInt(e.target.getAttribute("data-axis")[0]),i=parseInt(e.target.getAttribute("data-axis")[2]);if(e.dataTransfer.getData("coordinate")){const n=parseInt(e.dataTransfer.getData("coordinate")[0]),c=parseInt(e.dataTransfer.getData("coordinate")[2]);if(!this.currentPlayer.gameboard.changeOldShipCoordinateDragDrop(n,c,r,i,!1))return}else{const n=this.currentPlayer.gameboard.getShipCoordinateExpect(r,i,parseInt(s));if(this.currentPlayer.gameboard.isPlaceShipAble(n))this.currentPlayer.gameboard.placeShip(n);else return}const a=document.getElementById(t);a.setAttribute("data-coordinate",`${r}_${i}`),e.target.appendChild(a)}startGame(){let e=0;for(let t of this.factoryShips)e+=parseInt(Object.values(t)[0]);for(let t of this.players)if(t.gameboard.ships.length!==e){alert("Place enough ships before starting game");return}o.disableActionButtons(),this.isStart=!0}handleClickQuit(){location.reload()}handleCLickResetGame(){clearTimeout(this.timer),this.initialGame(),o.hideShowDivResult(),o.enableActionButtons(),o.enableAllPlayer(this.currentPlayer.name),this.isStart=!1}reverseShipDirection(e){if(this.isStart)return;const t=e.currentTarget.getAttribute("data-coordinate");if(!t)return;const s=parseInt(t[0]),r=parseInt(t[2]),i=this.currentPlayer.gameboard.changeOldShipCoordinateDragDrop(s,r,s,r,!0);i&&o.renderShipDirections(i)}}const P=new b;window.play=P;
